---
title: An investigation of factors affecting inferences from and reliablity of state-space age-structured assessment models
author: 
  - Timothy J. Miller^1,2^
  - Greg Britten^3^
  - Elizabeth N. Brooks^2^
  - Gavin Fay^4^
  - Alex Hansell^2^
  - Christopher M. Legault^2^
  - Chengxue Li^2^
  - Brandon Muffley^5^
  - Brian C. Stock^6^
  - John Wiedenmann^7^
date: "`r format(Sys.time(), '%d %B, %Y')`"
fontsize: 12pt
output:
  pdf_document:
#    citation_package: natbib
    fig_caption: yes
    includes:
      in_header:
      - options.sty
      - journalshortcuts.tex
    keep_tex: yes
    number_sections: yes
  html_document:
    df_print: paged
#  word_document: default
header-includes:
#- \usepackage{makecell}
csl: canadian-journal-of-fisheries-and-aquatic-sciences.csl
bibliography: manuscript.bib
#biblio-style: cjfas2.bst
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy=FALSE, tidy.opts=list(width.cutoff=60), warning = FALSE, message = FALSE, fig.align = "center")
#knitr::opts_knit$set(root.dir = '../' )
library(knitr)
library(tidyverse)
library(pander)
library(kableExtra)
library(png)
library(forcats)
type <- "latex"
if(knitr::is_latex_output()) type <- "latex"
if(knitr::is_html_output()) type <- "html"
```

$^1$corresponding author: timothy.j.miller@noaa.gov\
$^2$Northeast Fisheries Science Center, Woods Hole Laboratory, 166 Water Street, Woods Hole, MA 02543 USA\
$^3$Biology Department, Woods Hole Oceanographic Institution, 266 Woods Hole Rd. Woods Hole, MA, USA\
$^4$Department of Fisheries Oceanography, School for Marine Science and Technology, University of Massachusetts Dartmouth, 836 S Rodney French Boulevard, New Bedford, MA 02740, USA\
$^5$Mid-Atlantic Fishery Management Council, 800 North State Street, Suite 201, Dover, DE 19901 USA\
$^6$Institute of Marine Research, Nye Flødevigveien 20, 4817 His, Norway\
$^7$Department of Ecology, Evolution, and Natural Resources. Rutgers University\


\pagebreak

**keywords:** stock assessment, state-space, model selection, bias, convergence, retrospective patterns

## Abstract {-}


State-space models are increasingly used for stock assessment, and evaluations of their statistical reliability and best practices for selecting among process error configurations are needed. We simulated 72 operating models that varied fishing pressure and observation error across process errors in recruitment, survival, selectivity, catchability, and/or natural mortality. We fit estimating models with different assumptions on the process error source and whether median natural mortality or a stock-recruit relationship were estimated. Estimating models without a stock-recruit relationship that assumed the correct process error source and median natural mortality had high convergence rates and low bias. Bias was also low under many incorrect process error assumptions when there was contrast in fishing pressure and low observation error. Marginal AIC most accurately distinguished process errors on recruitment, survival, and selectivity, as well as larger magnitude process errors of other types. Retrospective patterns were generally small but were sizable for recruitment when observation error was high. These results help establish the statistical reliability of state space assessment models and pave the way for the next-generation of fisheries stock assessment


\pagebreak


\pagebreak

# Introduction {-}

Application of state-space models in fisheries stock assessment and management has expanded dramatically within International Council for the Exploration of the Sea (ICES), Canada, and the Northeast US [@nielsenberg14; @cadigan16; @pedersenberg17; @stockmiller21]. State-space models latent population characteristics as statistical time series with periodic observations that also may have error due to sampling or other sources of measurement error. Traditional assessment models may use state-space approaches to account for temporal variability in population characteristics [@methotwetzel13;@legaultrestrepo99], but these models treat the annual parameters as penalized fixed effects parameters where the variance parameters controlling the penalties are assumed known [@thorsonminto15]. Modern state-space models can estimate the annually varying parameters as random effects with variance parameters estimated using maximum marginal likelihood or corresponding Bayesian approaches. These latter approaches are considered best practice and a recommended for the next generation of stock assessment models [@hoyleetal22; @punt23].

State-space stock assessment models, with nonlinear functions of latent parameters and multiple types of observations with varying distributional assumptions, are one of the most complex examples of this analytical approach. Statistical aspects of state-space models and their application within fisheries have been studied extensively, but previous work has focused primarily on linear and Gaussian state-space models [@aeberhardetal18; @augeretal21]. Therefore, current understanding of the reliability of state-space models does not extend to usage for stock assessment.

As state-space models provide greater flexibility by allowing multiple processes to vary as random effects [@nielsenberg14; @aeberhardetal18; @stocketal21], one of the most immediate questions regards the implications of mis-specification among alternative sources of process error. Incorrect treatment of population attributes as temporally varying [@trijouletetal20; @liljestrandetal24] could lead to misidentification of stock status and biased population estimates, ultimately impacting fisheries management decisions [@legaultpalmer16; @szuwalskietal18; @croninpunt21]. Furthermore, biological, fishery, and observational processes are often confounded in catch-at-age data, which may adversely affect ability to distinguish between true process variability and observational error [@puntetal14; @stewartmonnahan17; @croninpunt21; @fischetal23; @lietalinreview_a].

@lietal24 conducted a full-factorial simulation-estimation study to assess model reliability when confounding random-effects processes (numbers-at-age, fishery selectivity, and natural mortality) were included. Their results suggest that while state-space models can generally identify sources of process error, overly complex models, even when misspecified (i.e., incorporating process error that did not exist in reality), often performed similarly to correctly specified models, with little to no bias in key management quantities. Similarly, @liljestrandetal24 found little downside in assuming process error in recruitment or selectivity, even when it was absent. 

Despite mounting efforts, several limitations remain. First, confounding processes that can be treated as random effects in the model were not thoroughly examined or tested within a simulation-estimation framework. Second, previous studies relied on operating models conditioned on specific fisheries, limiting their generalizability [@lietalinreview_a; @liljestrandetal24]. In particular, the effects of observation error and underlying fishing history have not been fully isolated in simulation study designs, making it challenging to disentangle the interplay between process and observation error magnitudes, as demonstrated in @fischetal23. Third, explicitly modeling stock-recruit relationships (SRRs) as mechanistic drivers of population dynamics is promising [@fleischmanetal13; @dupontaviceetal22], but reliability of inferences within integrated state-space age-structured models has not been evaluated. Evidence from other studies suggests that when both process and observation errors are unknown, estimating density dependence parameters becomes highly uncertain [@knape08; @polanskyetal09]. In particular, @knape08 demonstrated that stronger density dependence becomes increasingly difficult to estimate in the presence of observation error. Therefore, it is crucial to assess whether density dependence mechanisms can be estimated with sufficient precision for use in fisheries management [@augeretal16]. Finally, although the importance of autocorrelation in process errors is recognized, investigations of the ability to distinguish state-space assessment models with and without autocorrelation and whether such misspecification is detrimental to estimation of important population metrics are lacking [@johnsonetal16;@xuetal19].

In the present study, we conduct a simulation study with operating models (OMs) varying by degree of observation error, source and variability of process error, and fishing history. The simulations from these OMs are fitted with estimation models (EMs) that make alternative assumptions for sources of process error, whether a SRR was estimated, and whether natural mortality is estimated. Given the confounding nature of process errors, developing diagnostic tools to detect model misspecification is of great scientific interest and could aid the next generation of stock assessments [@augeretal21]. We evaluate whether convergence and Akaike Information Criterion (AIC) can correctly determine the source of process error and the existence of a SRR. We also evaluate when retrospective patterns occur and the degree of bias in the outputs of the assessment model that are important for management.

# Methods {-}

We used the Woods Hole Assessment Model (WHAM) to configure OMs and EMs in our simulation study [@millerstock20;@stockmiller21]. WHAM is an R package freely available via a github repository and is built on the Template Model Builder package [@kristensenetal16]. For this study we used [version 1.0.6.9000, commit 77bbd94](https://github.com/timjmiller/wham/tree/77bbd946e4881216a439933473d1c58b21c270c3). WHAM has also been used to configure OMs and EMs for closed loop simulations evaluating index-based assessment methods [@legaultetal23] and is currently used or accepted for use in management of numerous NEUS fish stocks [e.g., @nefsc22;@nefsc22a;@nefsc24].

We completed a simulation study with a number of OMs that can be categorized based on where process error random effects were assumed: recruitment (R, assumed present in all models), apparent survival (denoted R+S), natural mortality (R+M), fleet selectivity (R+Sel), or index catchability (R+q). We refer to the (R+S) OMs as modeling apparent survival because on logscale the random effects ($\epsilon_{a,y}$) are additive to the total mortality (F+M) between numbers at age, thus they modify the survival term. However, as @stockmiller21 note, these random effects can be due to events other than mortality, such as immigration, emigration, missreported catch, and other sources of misspecification.  For each OM, assumptions about the magnitude of the variance of process errors and observations are required and the values we used were based on a review of the range of estimates from Northeast Unite States (NEUS) assessments using WHAM.

In total, we configured 72 OMs with alternative assumptions about the source and magnitude of process errors, magnitude of observation error in indices and age composition data, and contrast in fishing pressure over time. We fitted 20 EMs to observations generated from each of 100 simulations where process errors were also simulated. Each EM differed in assumptions about the source of process errors, whether natural mortality (or the median for models with process error in natural mortality) was estimated, and whether a Beverton-Holt SRR was estimated within the EM. Details of each of the OMs and EMs are described below.

We did not use the log-normal bias-correction feature for process errors or observations described by [@stockmiller21] for OMs and EMs to simplify interpretation of the study results [@lietalinreview]. All code we used to perform the simulation study and summarize results can be found at https://github.com/timjmiller/SSRTWG/tree/main/Project_0/code. 

## Operating models {-}


### Population {-}

The population consists of 10 age classes, ages 1 to 10+, with the last being a plus group that accumulates ages 10 and older. We assume spawning occurs annually 1/4 of the way through the year. The maturity at age was a logistic curve with $a_{50}$ = 2.89 and slope = 0.88 (Figure \ref{om_inputs_fig}, top left).

Weight at age was generated with a von Bertalanffy growth function
$$
L_a = L_{\infty}\left(1 - e^{-k(a - t_0)}\right)
$$
where $t_0 = 0$, $L_\infty = 85$, and $k = 0.3$, and a L-W relationship such that 
$$
W_a = \theta_1 L_a^{\theta_2}
$$
where $\theta_1 = e^{-12.1}$ and $\theta_2 = 3.2$ (Figure \ref{om_inputs_fig}, top right).

We assumed a Beverton-Holt SRR with constant pre-recruit mortality parameters for all OMs. All biological inputs to calculations of spawning biomass per recruit (i.e., weight, maturity, and natural mortality at age) are constant in the apparent survival (R+S) selectivity (R+Sel), and survey catchability (R+q) process error OMs. Therefore, steepness and unfished recruitment are also constant over the time period for those OMs [@millerbrooks21]. We specified unfished recruitment equal to $e^{10}$ and $\Fmsy = F_{40\%} = 0.348$, which equates to a steepness of 0.69 and $a=0.60$ and $b = 2.4 \times 10^{-5}$ for the Beverton-Holt parameterization
\[
N_{1,y} = \frac{a \text{SSB}_{y-1}}{1 + b \text{SSB}_{y-1}} 
\]
(Figure \ref{om_inputs_fig}, bottom right). We assumed a value of 0.2 for the natural mortality rate in OMs without process errors on natural mortaliyt and for the median rate for OMs with process errors on natural mortality.

We used two fishing scenarios for OMs. In the first scenario, the stock experiences overfishing at 2.5\Fmsy for the first 20 years followed by fishing at \Fmsy for the last 20 years (denoted $2.5\Fmsy \rightarrow \Fmsy$). In the second scenario, the stock is fished at \Fmsy for the entire time period (40 years). The magnitude of the overfishing assumptions is based on average estimates of overfishing for NEUS groundfish stocks from @wiedenmannetal19 and similar to the approach in @legaultetal23.

We specified initial population abundance at age at the equilibrium distribution that corresponds to fishing at either $F = 2.5\times \Fmsy$ or $F = \Fmsy$. This implies that, for a deterministic model, the abundance at age would not change from the first year to the next. 

For OMs with time-varying random effects for M , steepness is not constant. However, we used the same $a$  and $b$ parameters as other OMs, which equates to a steepness and R0 at the median of the time series process for M. For OMs with time-varying random effects for fishery selectivity, \Fmsy is also not constant, but since we use the same F history as other OMs, this corresponds to \Fmsy at the mean selectivity parameters.

### Fleets {-}

We assumed a single fleet operating year round for catch observations with logistic selectivity for the fleet ($a_{50} = 5$ and slope = 1; Figure \ref{om_inputs_fig}, bottom left). This selectivity was used to define \Fmsy for the Beverton-Holt SRR parameters above. We assumed a logistic-normal distribution with no correlation on the multivariate normal scale for the age-composition observations for the fleet.

### Indices {-}

Two time series of fishery-independent surveys in numbers are generated for the entire 40 year period with one occurring in the spring (0.25 of each year) and one in the fall (0.75 of each year).  Catchability of both surveys are assumed to be 0.1.  Like the fishing fleet, we assumed logistic selectivity for both indices ($a_{50} = 5$ and slope = 1) and a logistic-normal distribution with no correlation on the multivariate normal scale for the age-composition observations.

### Observation Uncertainty {-}

The standard deviation for log-aggregate catch was 0.1. Two levels of observation error variance (high and low) were specified for indices and all age composition observations (both indices and catch). The low uncertainty specification assumed a standard deviation of 0.1 for both series of log-aggregate index observations, and the standard deviation of the logistic-normal for age composition observations was 0.3. In the high uncertainty specification, the standard deviation for log-aggregate indices was 0.4 and that for the age composition observations was 1.5. For all EMs, the standard deviation for log-aggregate observations was assumed known whereas that for the logistic-normal age composition observations was estimated.

### Operating models with random effects on numbers at age {-}

For operating models with random effects on recruitment and(or) apparent survival (R, R+S), we assumed marginal standard deviations for recruitment of $\sigma_R \in \{0.5,1.5\}$ and marginal standard deviations for older age classes of $\sigma_{2+} \in \{0,0.25, 0.5\}$. The full factorial combination of these process error assumptions (2x3 levels) and scenarios for fishing history (2 levels) and observation error (2 levels) scenarios described above results in 24 different R ($\sigma_{2+} = 0$) and R+S operating models (Table \ref{naa_om_table}).

### Operating models with random effects on natural mortality {-}
All R+M OMs treat natural mortality as constant across age, but with annually varying random effects. WHAM treats natural mortality as a log-transformed parameter 
$$
\log M_{y,a} = \mu_{M} + \epsilon_{M,y}
$$
that is a linear combination of a mean log-natural mortality parameter that is constant across ages ($\mu_{M} = \log(0.2)$) and any annual random effects are marginally distributed as $\epsilon_{M,y} \sim \text{N}\left(0,\sigma_M^2\right)$. The marginal standard deviations we assumed for log natural mortality random effects were $\sigma_M \in \{0.1, 0.5\}$ and the random effects were either uncorrelated or first-order autoregressive (AR1, $\rho_M \in \{0,0.9\}$). Uncorrelated random effects were also included on recruitment with $\sigma_R = 0.5$ (hence, we denote these OMs as  R+M). The full factorial combination of these process error assumptions and fishing history (2 levels) and observation error (2 levels) scenarios described above results in 16 different R+M OMs (Table \ref{M_om_table}).


### Operating models with random effects on fleet selectivity {-}


WHAM treats selectivity parameter $s$ as a logit-transformed parameter 
$$
\log\left(\frac{p_{s,y}-l_{s}}{u_{s}-p_{s,y}}\right) = \mu_s + \epsilon_{s,y}
$$
that is a linear combination of a mean $\mu_s$ and any annual random effects marginally distributed as $\epsilon_{s,y} \sim \text{N}\left(0,\sigma_s^2\right)$, where the lower and upper bounds of the parameter ($l_s$ and $u_s$) can be specified by the user. All selectivity parameters ($a_{50}$ and slope parameters) were bounded by 0 and 10 for all OMs and EMs. The marginal standard deviations we assumed for logit scale random effects were $\sigma_s \in \{0.1, 0.5\}$ and AR1 autocorrelation parameters of $\rho_s \in \{0,0.9\}$.  Like R+M OMs, the full factorial combination of these process error assumptions (2x2 levels) and scenarios described above for fishing history (2 levels) and observation error (2 levels) results in 16 different R+Sel OMs (Table \ref{sel_om_table}).

### Operating models with random effects on index catchability {-}

Like selectivity parameters, WHAM treats catchability for an index $i$ as a logit-transformed parameter 
$$
\log\left(\frac{q_{i,y}-l_{i}}{u_{i}-q_{i,y}}\right) = \mu_i + \epsilon_{i,y}
$$
that is a linear combination of a mean $\mu_i$ and any annual random effects marginally distributed as $\epsilon_{i,y} \sim \text{N}\left(0,\sigma_i^2\right)$ where the lower and upper bounds of the catchability ($l_i$ and $u_i$) can be specified by the user. We assumed bounds of 0 and 1000 for all OMs and EMs. For all OMs and EMs with process errors on catchability, the temporal variation only applies to the first index, which could be interpreted as capturing some unmeasured seasonal process that affects availability to the survey. The marginal standard deviations we assumed for logit scale random effects were $\sigma_i \in \{0.1, 0.5\}$ and AR1 autocorrelation parameters of $\rho_i \in \{0,0.9\}$.  Like R+M and R+Sel OMs, the full factorial combination of these process error assumptions and fishing history (2 levels) and observation error (2 levels) scenarios described above results in 16 different R+q OMs (Table \ref{q_om_table}).

## Estimation models {-}

For each of the data sets simulated from an OM, 20 EMs were fit. A total of 32 different EMs were fit across OMs where the subset of 20 depended on the source of process error in the OM (Table \ref{em_table}). The EMs have different assumptions about the source of process error (R+S, R+M, R+Sel, R+q) and whether or not 1) there is temporal autocorrelation, 2) a Beverton-Holt SRR is estimated, and 3) the natural mortality rate ($\mu_M$, the constant or mean on log scale for R+M EMs) is estimated. For simplicity we refer to the derived estimate $e^{\mu_M}$ as the median natural mortality rate regardless of whether natural mortality random effects are estimated in the EM. 

Subsets of 20 EMs in Table \ref{em_table} were fit to simulate data sets from each of the OM process error categories. For R and R+S OMs, fitted EMs had matching process error assumptions as well as R+Sel, R+M, and R+q assumptions without autocorrelation. Similarly, For other OM process error categories, we fit EMs with matching process error assumptions as well as other process error types without autocorrelation. The maturity at age, weight at age for catch and SSB, and observation error variance of aggregate catch and indices were all assumed known at the true values. However, the variance parameters for the logistic-normal distributions for age composition observations were estimated in the EMs. As such, EMs would either be configured completely correctly for the OM, or there could be mis-specification in assumptions of process error autocorrelation, the type of process error, or the SRR (Beverton-Holt or none). 

## Measures of reliability {-}

### Convergence {-}

The first measure of reliability we investigated was frequency of convergence when fitting each EM to the simulated data sets. There are various ways to assess convergence of the fit [e.g., @carvalhoetal21; @kapuretal24], but given the importance of estimates of uncertainty when using assessment models in management, we estimated probablity of convergence as measured by occurrence of a positive-definite hessian matrix at the optimized negative log-likelihood that could be inverted. We also provide results in the Supplementary Materials for the maximum of the absolute values among all gradients for all fits of a given EM to all simulated data sets from a given OM that produced hessian-based standard errors for all estimated fixed effects. This provides an indication of how poor the calculated gradients can be, but still presumably converged adequately enough for parameter inferences. We used the Clopper-Pearson exact method for constructing 95\% confidence intervals of the probabilities of convergence [@clopperpearson34;@thulin14].


### AIC for model selection {-}

We estimated the probability of selection of each process error model structure (R, R+S, R+M, R+Sel, R+q) using marginal AIC. For a given operating model, we compared AIC for EMs that were all configured the same for median natural mortality (known or estimated) and the SRR (Beverton-Holt or none). 

We also estimated the probability of correctly selecting between EMs with Beverton-Holt SRR assumed and models without the SRR (null model). We made these comparisons between models that otherwise assumed the same process error structure as the operating model and both of the compared models either estimate median natural mortality or assume it is known. Contrast in fishing pressure and time series with recruitment at low stock size has been shown to improve estimation of SRR parameters [@magnussonhilborn07; @connetal10]. Our preliminary inspections of the proportions of simulations where the correct recruitment model was chosen for a given set of OM factors (including contrast in fishing pressure) indicated generally poor performance of AIC. Therefore, we fit logistic regression models to the indicator of Beverton-Holt models having lower AIC as a function of the log-standard deviation of the true log(SSB) (similar to the log of the coefficient of variation for SSB) since simulations with realized SSB producing low and high recruitments would have larger variation in realized SSB.


All model selection results condition on whether all of the compared estimating models completed the optimization process without failure. We did not condition on convergence as defined by a gradient threshold or invertibity of the hessian because optimization could correctly determine an inappropriate process error assumption by estimating variance parameters at the lower bound of zero. Such an optimization could indicate poor convergence but the likelihood would be equivalent to that without the mis-specified random effects and the AIC would be appropriately higher because more (variance) parameters were estimated. All other measures of reliability described below (bias and Mohn's $\rho$) use these same criteria for inclusion of EM fits in the summarized results.

### Bias {-}


For a given model attribute we calculated the relative error 
$$
\text{RE}\left(\theta_i\right) = \frac{\widehat \theta_i - \theta_i}{\theta_i}
$$
from fitting a given estimating model to simulated data set $i$ configured for a given OM where $\widehat \theta_i$ and $\theta_i$ are the estimated and true values for simulation $i$. We estimated bias as the median of the relative errors across all simulations for a given OM and EM combination. We constructed 95\% confidence intervals for the median relative bias using the binomial distribution approach as in @millerhyun18 and @stockmiller21. We present results for bias in terminal year estimates of SSB and recruitment, Beverton-Holt stock recruit parameters ($a$ and $b$), and median natural mortality rate. Results for terminal year fishing mortality are were strongly negatively correlated with those for SSB and are provided in the Supplementary Materials.

<!--
Similar to the AIC results, bias results only condition on whether the estimating model completed the optimization process without failure. We did not condition on convergence as defined by a gradient threshold or invertibility of the hessian because the optimized model can provide reliable estimation of assessment model output whether or not the model was able to estimate non-zero random effects. In practice, the model would be reconfigured to remove unnecessary process errors and produce otherwise equivalent parameter estimates.
-->

### Mohn's $\rho$ {-}

We calculated Mohn's $\rho$ for SSB, fully-selected fishing mortality, and recruitment for each EM [@mohn99]. We fit 7 peels for each EM and calculated median 95\% confidence intervals for Mohn's $\rho$ using the same methods as that for relative bias. <!--Similar to the other results, retrospective results only condition on whether all of the peels of a given estimating model completed the optimization process without failure. We did not condition on convergence as defined by a gradient threshold or invertibility of the hessian because the optimized model can provide reliable estimation of SSB, fishing mortality rates, and recruitment whether or not the model was able to estimate non-zero random effects. -->

# Results {-}

## Convergence performance {-}

For R and R+S OMs, convergence generally declined for most EMs when the median natural mortality rate was estimated and/or the Beverton-Holt SRR was estimated even when the process error assumptions of the EMs and OMs matched (Figure \ref{hessian_SE_convergence}, A). When there was high observation error and constant fishing pressure ($F = F_{\text{MSY}}$ for all 40 years), convergence was poor for of all EM process error configurations other than R EMs when fitted to R OMs ($\sigma_{2+} = 0$) regardless of whether median natural mortality and SRRs were estimated. Convergence of R EMs was high for all R and R+S OMs except when there was high observation error and constant fishing pressure, and when median natural mortality and SRRs were estimated. R+S EMs fit to R OMs exhibited poor convergence regardless of whether natural mortality or a SRR was estimated. R+S EMs fit to R+S OMs had highest convergence rates when there was contrast in fishing pressure and low observation error. Convergence rates were high for all EMs when fit to data from R+S OMs with lower observation error except those where median natural mortality and/or SRRs were estimated. 

Convergence of all EMs fitted to R+M OMs was highest when the OMs had higher natural mortality process error variability, low observation error, and contrast in fishing pressure  (Figure \ref{hessian_SE_convergence}, B). R+M EMs that estimated autocorrelation of process errors had poor convergence for R+M OMs when there was low natural mortality process error variability regardless of autocorrelation of the simulated process errors. R+S EMs fitted to data generated from R+M OMs always converged poorly whether or not median natural mortality and the Beverton-Holt SRR were estimated.

The R+S EMs, in particular, had poor convergence when fit to data generated from R+Sel OMs with lower selectivity process error variability or higher observation error (Figure \ref{hessian_SE_convergence}, C). R+Sel EMs generally converged better than other EMs for R+Sel OMs with higher process error variability, lower observation error, and contrast in fishing pressure regardless of whether median natural mortality or a SRR was estimated.

For R+q OMs, convergence of R+q EMs was generally better than that of other EMs when there was contrast in fishing pressure (Figure (\ref{hessian_SE_convergence}, D).  Convergence of R+S EMs was generally worse than that of all other EMs across all OMs whether or not median natural mortality or a SRR was estimated. Again, convergence probability generally declined for all EMs when median natural mortality or a SRR was estimated.

We found a wide range of maximum absolute values of gradients for models that converged (Figure \ref{hess_grad}). The largest value observed for a given EM and OM combination was typically $<10^{-3}$, but many converged models had values greater than 1. For many OMs, EMs that assumed the correct process error type and did not estimate median natural mortality or the Beverton-Holt SRR produced the lowest gradient values.

## AIC performance for process error structure {-}

Marginal AIC accurately determined the correct process error assumptions in EMs when data were generated from R and R+S OMs, regardless of whether median natural mortality or a SRR was estimated (Figure \ref{pe_aic}, A). Attempting to estimate median natural mortality or a SRR separately had a negligible effect on the accuracy of determining the correct process error assumption. When both were estimated, there was a noticeable reduction in accuracy when OMs had a constant fishing pressure, low observation error, and larger variability in recruitment process errors.

For R+M OMs, marginal AIC only accurately determined the correct process error model and correlation structure when observation error was low and variability in natural mortality process errors was high (Figures \ref{pe_aic}, B). Of these OMs, estimating the median natural mortality rate only reduced the accuracy of AIC when natural mortality process errors were independent and fishing pressure was constant. For OMs with poor model selection accuracy, AIC most frequently selected EMs with process errors in catchability (R+q) or selectivity (R+Sel). Selection of R+S EMs was generally unlikely.

Marginal AIC most accurately determined the correct source of process error and correlation structure for R+Sel OMs with low observation error (Figures \ref{pe_aic}, C). When there was low variability in selectivity process errors and high observation error, R+q or R+S EMs were more likely to have the best AIC. Whether median natural morality or SRRs were estimated appeared to have little effect on the performance of AIC.

Marginal AIC most accurately determined the correct source of process error and correlation structure for R+q OMs with high variability in catchability process errors (Figures \ref{pe_aic},D). The R+q OMs with low variability in catchability process errors and high observation error had the least model selection accuracy. However, for these OMs, the marginal AIC accurately determined the correct source of process error (but not correlation structure) except when OMs assumed a constant fishing pressure and EMs estimated both median natural morality and the SRR. 

## AIC performance for the stock-recruit relationship {-}

Our comparisons of model performance conditioned on assuming the true process error configuration is known (EM and OM process error types match) and we focus on results where the EMs assume median natural mortality is known because there was little difference in results when the EMs estimated this parameter. Broadly, we found generally poor accuracy of AIC in selecting models assuming a Beverton-Holt SRR over the null model without an SRR for all OMs. However, we also found increased accuracy of AIC in determining the Beverton-Holt SRR when the simulated population exhibited greater variation in spawning biomass for nearly every OM (Figure \ref{sr_aic}).

With R and R+S process error assumptions, probability of lowest AIC for the B-H SRR as a function of SSB variability were greatest for OMs with contrast in fishing pressure and lower process variability in recruitment (Figure \ref{sr_aic}, A). The largest variation in SSB occurred in OMs with larger recruitment variability ($\sigma_R = 1.5$; Figure \ref{sr_aic}, A, right column group), but the same high AIC accuracy was achieved for OMs with lower recruitment variability at lower levels of SSB variation. The level of observation error had little effect on AIC accuracy.

For R+M OMs, probability of lowest AIC for the Beverton-Holt SRR increased steeply with variation in SSB whether it was induced by contrast in fishing or variation in natural mortality process error. (Figure \ref{sr_aic}, B). There was little difference in AIC accuracy whether the natural mortality process errors were correleted and, similar to R+S OMs, there was also little effect due to level of observation error.

For R+Sel OMs, contrast in fishing pressure over time was the primary source of variation in SSB and these are the OMs where AIC accuracy for the Beverton-Holt SRR was greatest (Figure \ref{sr_aic}, C). There was little effect of variability or correlation of selectivity process errors or the level of observation error on AIC accuracy.

Like the R+Sel OMs, the greatest accuracy for AIC in selecting the Beverton-Holt SRR occurred for R+q OMs where there was contrast in fishing pressure over time which is also where there was the greatest variation in SSB (Figure \ref{sr_aic}, D). There was also little effect of variability or correlation of catchability process errors or the level of observation error on AIC accuracy.

## Bias {-}

### Spawning stock biomass and recruitment {-}

For R OMs ($\sigma_{2+} = 0$), there was no indication of bias (95\% confidence intervals included 0) in terminal year SSB for any of the estimating models regardless of process error assumptions, except when no SR assumption was made, recruitment variability was low, and there was contrast in fishing mortality and high observation error (Figure \ref{SSB_rel_error}, A). However, errors in terminal SSB estimates were highly variable when median natural mortality was estimated and there was constant fishing pressure and high observation error (Figure \ref{SSB_rel_error}, A, second row). 

For R+S OMs, the EMs with matching process error assumptions generally produced unbiased estimation of terminal SSB except when median natural mortality was estimated and there was high observation error. In R+S OMs with low observation error, EMs with incorrect process error assumptions typically provided biased estimation of terminal year SSB. Estimating the Beverton-Holt SRR had little discernible effect on bias of terminal year SSB estimation whereas estimating median M tended to produce more variability in errors in terminal SSB estimation similar to R OMs.

For R+ M OMs with low variability in natural mortality process errors, low observation error and contrast in fishing motality over time all EMs produced low variability in SSB estimation error that indicated unbiasedness (Figure \ref{SSB_rel_error}, B, third row). However, larger variability in natural mortality process errors increased bias of EMs without the correct process error type. Estimating median natural mortality increased variability of SSB estimation error particularly for OMs with high observation error and constant fishing pressure over time.  It also increased bias in SSB estimation for many R+M OMs. Like R and R+S OMs, estimating a SRR had little discernible effect on SSB bias.

For R+Sel OMs, there was no evidence of bias for any EMs when variability in selectivity process error and observation error was low, and with contrast in fishing mortality (Figure \ref{SSB_rel_error}, C). The largest bias occurred for any EMs that estimated median natural mortality when the OMs had high observation error, constant fishing pressure, and greater variability in selectivity process errors ($\sigma_{\text{Sel}} = 0.5$) or low selectivity process errors ($\sigma_{\text{Sel}} = 0.1$) and low observation error. However, there was no evidence of SSB bias for correctly specified R+Sel EMs when observation error was low and variation in selectivity process errors was larger, whether median natural mortality was estimated or not (Figure \ref{SSB_rel_error}, C, third row). We only observed an effect of estimating the Beverton-Holt SRR for R+Sel OMs that had high observation error and contrast in fishing pressure where estimating the SRR produced less biased SSB estimation for many EMs (Figure \ref{SSB_rel_error}, C, top row).

All EMs fit to data from R+q OMs with low observation error and  contrast in fishing pressure exhibited little evidence of bias in terminal SSB estimation except for R+M EMs when there was no AR1 correlation in catchability process errors (Figure \ref{SSB_rel_error}, D). Many EMs also performed well in R+q OMs with low observation error, but no contrast in fishing pressure. For R+q OMs with high observation error and contrast in fishing pressure, EMs that estimated the Beverton-Holt SRR exhibited less SSB bias than those that did not. Estimating median natural mortality in the EMs only resulted in much more variable SSB estimation errors when there was no contrast in fishing pressure (Figure \ref{SSB_rel_error}, D, first and third rows).

For all OM process error types, relative errors in terminal year recruitment were generally more variable than SSB, but effects of R and R+S OM and EM attributes on bias (i.e, negative or positive or none) were similar (Figure \ref{R_rel_error}, A). Furthermore, for EM configurations where bias in terminal SSB was evident, median relative errors in recruitment often indicated stronger bias in recruitment of the same sign.

### Beverton-Holt parameters{-}

Across all OMs, there was generally better accuracy (less bias and/or lower variability) for estimation of the Beverton Holt $a$ parameter than the $b$ parameter. In R and R+S OMs, EMs with the correct assumptions about process errors provided the least biased estimation of Beverton-Holt SRR parameters when there was a change in fishing pressure over time and lower variability of recruitment process errors, but there was little effect of estimating median natural mortality and a small increase in bias for those OMs that had high observation error (Figure \ref{SR_rel_error}, A). For other R and R+S OMs, estimating natural mortality often resulted in less biased estimation of SRR parameters. There was generally large variability in relative errors of the SRR parameter estimates, but the lowest variability occurred with low variability in recruitment and little or no variability in survival process errors ($\sigma_{2+} \in \{0,0.25\}$), and contrast in fishing pressure. 

In R+M OMs, the most accurate estimation of SRR parameters for all EM process error assumptions occurred when there was a change in fishing pressure, greater variability in natural mortality process errors, and lower observation error (Figure \ref{SR_rel_error}, B). Relative to the R, and R+S OMs, there was even less effect of estimating median natural mortality on estimation bias for the SRR parameters.

Bias for SRR parameters was large and variability in relative errors was greatest for most EMs fit to R+Sel OMs with constant fishing pressure (Figure \ref{SR_rel_error}, C). Less bias in parameter estimation occurred for OMs with a change in fishing pressure and the best accuracy occurred for those OMs that had low observation error and more variable and uncorrelated selectivity process errors, and when the EMs hadd with the correct process error assumption. There was little effect of estimating natural mortality on relative errors for SRR parameters.

Like R+Sel OMs, relative errors in SRR parameters for R+q OMs were more accurate for most EM process error types when OMs had contrast in fishing pressure and lower observation error (Figure \ref{SR_rel_error}, D). However, the best accuracy occurred for those OMs that had lower variability in catchability process errors. The worst accuracy of SRR parameter estimation regardless of EM type occurred when R+q OMs had low observation error and constant fishing pressure (Figure \ref{SR_rel_error}, D, fourth row).

### Median natural mortality rate {-}

Across all OMs and EMs there was little effect of estimating SRRs on the bias in estimation of median natural mortality (Figure \ref{M_rel_error}). Median natural mortality rate was estimated accurately by all EM process error types for all R OMs except those with high observation error and constant fishing pressure, in which case relative errors were high (Figure \ref{M_rel_error}, A, $\sigma_{2+} = 0$).  For R+S OMs estimation of median natural mortality rate was most accurate when observation error was low and there was contrast in fishing pressure and the EM process error type was correct. 

For R+M OMs, median natural mortality was estimated most accurately, regardless of EM process error type, when OMs had a change in fishing pressure and low observation error (Figure \ref{M_rel_error}, B). However, those R+M OMs that also had greatest variability in AR1 correlated natural mortality process errors only had unbiased estimation when the EM process error type was correct. 

All EM process error types accurately estimated median natural mortality rate for R+Sel OMs that had contrast in fishing pressure, low observation error, and low selectivity process error variability (Figure \ref{M_rel_error}, C). When selectivity process error variability increased, the incorrect EM process errors produce more biased estimation of median natural mortality rate. The least accurate estimation occurred for all EM process error types when observation error was high and fishing pressure was constant. 

Like R+Sel OMs, all EM process error types produced accurate estimation of median natural mortality rate when fit to R+q OMs with contrast in fishing pressure, low observation error and low catchability process error variability (Figure \ref{M_rel_error}, D). Most EM process error types produced biased estimation of median natural  mortality when R+q OMs had high observaiton error and constant fishing pressure. 

Like R+Sel OMs, all EM process error types produced accurate estimation of median natural mortality rate when fit to R+q OMs with contrast in fishing pressure, low observation error and low catchability process error variability (Figure \ref{M_rel_error}, D). Most EM process error types produced biased estimation of median natural mortality when R+q OMs had high observation error and constant fishing pressure. 

## Mohn's $\rho$ {-}

Mohn's $\rho$ for SSB was small in absolute value for all R and R+S OMs, regardless of EM process error types, and whether median natural mortality rate or SRRs were estimated (Figure \ref{mohns_rho_ssb}, A). The strongest retrospective patterns (highest absolute Mohn’s $\rho$ values) occurred in OMs with the largest apparent survival process error variability, high observation error, and contrast in fishing pressure, but only for EMs with the incorrect process error type and where median natural mortality rate was assumed known (median $\rho$ was approximately -0.15). For R+M, R+Sel, and R+q OMs, Mohn's $\rho$ was also small in absolute value, but median values were all closer to 0 than the largest values in the R and R+S OMs (Figure \ref{mohns_rho_ssb},B-D). For these OMs, there was no noticeable effect of estimation of median natural mortality rate or SRRs on Mohn's $\rho$ for any EM process error types.

Mohn's $\rho$ for recruitment was small in absolute value for all R OMs with low variability in recruitment process errors, regardless of EM process error type, and whether median natural mortality rate or SRRs were estimated (Figure \ref{mohns_rho_R}, A). However, R and R+S OMs with greater recruitment process variability and higher observation error had median Mohn's $\rho$ for recruitment greater than zero for most EMs even when the EM process error type was correct. In R+S OMs with lower observation error, EMs with the correct process error type exhibited better median Mohn's $\rho$ close to 0 than EMs with the incorrect process error type. For R+M, R+Sel, and R+q OMs, results for Mohn's $\rho$ for recruitment are similar to those for SSB, but the range in median values and variation in Mohn's $\rho$ values for a given OM are generally larger for recruitment (Figure \ref{mohns_rho_R}, B-D).

# Discussion {-}

## Convergence {-}


Analyses of model convergence across simulations can be useful for understanding the utility of alternative convergence criteria used in applications to real data for directing the practitioner to more appropriate random effects configurations. It is common during the assessment model fitting process to check that the maximum absolute gradient component is less than some threshold prior to inspecting the Hessian of the optimized likelihood for invertibility [@carvalhoetal21]. However, there is no accepted standard for the gradient threshold [e.g., @leeetal11; @hurtadoferroetal15;@ruddthorson18] and some thresholds would exclude models that in fact have an invertible Hessian. We found the Hessian at the optimized log-likelihood can often be invertible when the maximum absolute gradient was much larger than what would perceived to be a sensible threshold.

@lietal24 found that convergence rate could be a useful diagnostic especially for separating the correct model from overly complex models. However, the criteria for convergence used in their study may also lead to limited ability to distinguish the correct model from overly simplistic models, a pattern that was also noted by @liljestrandetal24 in which one process error may absorb all sources of process error when the magnitude of other process errors are low. 

Often poor convergence result when parameter estimates are at their bounds [@carvalhoetal21], and this also applies to variance parameters for random effects with state-space assessment models. Even when Hessian is invertible, parameters that are poorly informed will have extremely large variance estimates. This further inspection can lead to a more appropriate and often more parsimonious model configuration where the problematic parameters are not estimated. For example, process error variance parameters that are estimated close to 0 indicates that the random effects are estimated to have little or no variability and removing these process errors is warranted. Generally, our results suggest we can expect lower probability of convergence of state-space assessment models when estimating natural mortality or SRRs because of the difficulty distinguishing these parameters from others being estimated in assessment model with data that are typically available. Our experiments did not aim to emulate the practitioner decision process in developing model configurations (e.g. removing a source of process error and refitting the model when process error variance parameters were estimated close to 0). Evaluating the efficacy of such a decision process when applying Ems might be important in closed loop simulations (e.g. MSE) aimed at quantifying management performance.

A factor affecting the convergence criteria, particularly for maximum likelihood estimation of models with random effects, is numerical accuracy. All optimizations performed in these simulations are of the Laplace approximation of the marginal likelihood and, therefore, gradients and Hessians are also with respect to this approximation (see TMB::sdreport in the Template Model Builder package). Functionality within the Template Model Builder package exists (i.e., TMB::checkConsistency) to check the validity of the Laplace approximation and the utility of this as a diagnostic for state-space assessment models should be explored further. Furthermore, numerical methods are used to calculate and invert the Hessian for variance estimation for models with random effects. Along with our results, the potential lack of accuracy imposed by these approximations, suggests at least investigating whether the Hessian is positive definite when the calculated absolute gradients are not terribly large. 

## AIC {-}

Of the OM process error configurations we considered, we found AIC to be accurate for selecting models with process errors on recruitment and apparent survival (R and R+S). Fitting models to other OMs rarely preferred R+S EMs, and R and R+S EMs were nearly always selected for the matching OMs; a similar result was reported by @liljestrandetal24. For other sources of process error, accuracy of AIC was improved to useful levels when there was larger variability in the process errors and/or lower observation error.

Across all OM process error configurations, AIC performed poorly in identifying that the presence of the Beverton-Holt SRR in the OM unless there was contrast in fishing pressure possibly in combination with other factors such as lower variability in recruitment process errors (in R and R+S models) or greater variation in natural mortality process errors (for R+M OMs, Fig. \ref{sr_aic}). As such, properly accounting for process error in natural mortality could be important [@lietal24] when evaluating SRRs in state-space models. Curiously, we did not find a marked effect of the level of observation error on ability to detect the SRR, but it is possible that AIC would perform better if observations have even lower uncertainty than we considered.

Although we did not compare models with alternative SRRs (e.g., Ricker and Beverton-Holt), we do not expect AIC to perform any better distinguishing between relationships. Our finding that AIC tended to choose simpler recruitment models in most cases contrasts with the noted bias in AIC for more complex models [@shibata76;@katz81;@kassraftery95], but, whereas those findings apply to more the much more common comparison of models that are fit to raw and independent observations, here we are comparing state-space models which account for observation error and estimate process errors in latent variables.

Our results comport with those of @devalpinehastings02 who found AIC could not distinguish among state-space SRRs that were fit just to SSB and recruitment observations (i.e., not an assessment model). Similarly,  @brittenetalinreview found AIC could not reliably distinguish alternative environmental effects on SRR parameters. However, @milleretal16 did find AIC to prefer a SRR with environmental effects when applied to data for the SNEMA yellowtail flounder stock and  AIC also selected an environmental covariate on a SRR for the most recent stock assessment of Georges Bank yellowtail flounder [@nefsc25]. Both of these yellowtail flounder stocks have large changes in stock size and the values of environmental covariates over time. Additionally, this species is well-observed by the bottom trawl survey that is used for an index in assessment models.

## Bias {-}

As expected, bias in all parameters and assessment output was generally improved with lower observation error. Estimation of SRR parameters was reliable in ideal scenarios of low observation error and contrast in fishing for some R+Sel and R+M OMs, but generally estimation was biased and(or) highly variable. We found substantial bias in estimated SRR parameters in R and R+S OMs particularly with high variability in recruitment and apparent survival process errors, suggesting that practitioners should be cautious when models without the SRR suggest this to be the case.

On the other hand, estimation of median natural mortality was reliable in many OM scenarios with contrast in fishing pressure and in some OMs EMs that also estimated the SRR parameters bias for those parameters was improved.  Conversely, for some R+Sel and R+q OMs where there was bias in natural mortality due to high observation error, estimating the SRR reduced the bias in median natural mortality rate.  However, estimating median natural mortality did cause poor accuracy in SSB estimation in many OMs without contrast in fishing pressure over time and with higher observation error. Thus, estimating median natural mortality should be approached with caution in state-space assessment models, particularly given its significant impact on determination of reference point and stock status [@lietal24]. 

## Retrospective patterns {-}

Incorrect EM process error assumptions did not produce strong retrospective patterns for SSB for any OMs regardless of whether median natural mortality or a SRR was estimated, but some weak retrospective patterns occur when observation error was high and there was contrast in fishing pressure. However, retrospective patterns tended to be more variable for recruitment and were sometimes large even when the EM was correct. Therefore, we recommend emphasis on inspection of retrospective patterns primarily for SSB and $F$, but further research on retrospective patterns in other assessment model parameters, management quantities such as biological reference points, and projections may be beneficial [@brookslegault16]. 

The general lack of retrospective patterns with mis-specified process errors is perhaps to be expected. Retrospective patterns are often induced in simulation studies by rapid changes in a quantity such as index catchability, natural mortality, or perceived catch during years toward the end of the time series [@legault09; @millerlegault17; @huynhetal22; @breiviketal23]. In our simulations, the process errors changing over time may have trends in particular simulations, particularly when strong autocorrelation is imposed, but the random effects have no trend on average across simulations. @szuwalskietal18 and lietal24 also found relatively small retrospective patterns when the source of mis-specification was temporal variation in demography attributes. Indeed, it is common for the flexibility provided by temporal random effects to reduce retrospective patterns [@milleretal18; @stockmiller21; @stocketal21], though it does not necessarily indicate a more accurate assessment model [@perrettietal20; @lietal24; @liljestrandetal24]. Our results together with the existing literature seem to suggest that when a strong retrospective pattern is observed in an assessment it is more likely to be due to a mis-specification of a rapid shift in some model attribute rather than whether a particular process is assumed to be randomly varying temporally.

<!--
Finally, although the EMs estimated observation variance parameters for the age composition observations, they were provided the correct precision of the aggregate indices and catch which 

The R+q OMs only have temporal variation in catchability for one index so the other index is able to provide a consistent signal of trend. Incorrect assumptions about the mean selectivity model could also produce 

Lack of retrospective patterns for SSB coupled with biased terminal SSB estimates would indicate that the scale across the time series is biased and
-->

## Conclusions {-}

Our simulation study examined the importance of several factors for reliable inferences from state-space age-structured assessment models. Across all factors, AIC accurately distinguished models with process errors on recruitment only or on recruitment and apparent survival. Accuracy for other process error types required a strong signal (high process variability) with low noise (low observation uncertainty). Therefore, we expect practitioners will find R+S configurations to provide satisfactory diagnostics across a range of life history and data quality scenarios. Contrast in fishing pressure was consistently an important factor across all measures of reliability we examined. AIC generally performed poorly for selecting the SRR but performance was improved with low recruitment variability and contrast in fishing pressure. However, some bias in estimation in at least one of the SRR parameters existed in nearly all OM-EM combinations. Because bias in terminal SSB and retrospective patterns were indifferent to whether or not the SRR was estimated, and convergence was slightly better without the SRR, a sensible default would be to fit models without an assumed SRR.

<!--
All together what do results mean? E.g., when do you get good convergence and retrospective patterns and high/none bias? When do you get good convergence and no retros and no/big bias?

For R+S OMs with low observation error, temporal contrast in fishing pressure, and large variation in survival process errors (3rd row), some EMs with the incorrect process error assumptions, estimate median M to be 0, and SSB is also underestimated, but Mohn's $\rho$ for SSB is better than when M is known. Fortunately, AIC would not choose the wrong EM process error type in these situations.

When R+S is preferred AMONG THE TYPES CONSIDERED HERE, it probably means its the correct process error .
-->


<!--
## Summary {-}

We conducted a simulation study where we simulated process errors and observations for 72 operating models with alternative assumptions about fishing history, degree of uncertainty in index and age composition observations, type (recruitment, survival, fishery selectivity, catchability and natural mortality), degree of variation, and correlation of process errors. We fit 20 different estimation models to each of 100 simulated set of observations with alternative assumptions type and correlation structure of process errors, median natural mortality was known or estimated, and a B-H SRR was assumed or not.

Across simulations we summarized probability of convergence of fitted models, accuracy of marginal AIC in determining the correct process error assumption and it ability to determine the Beverton-Holt SRR, bias in annual spawning stock biomass, in estimation of natural mortality, and in SRR parameters, and severity of retrospective patterns for estimation models.

Alternative measures of convergence performed differently. Invertible hessians and resulting standard error estimation was possible when criteria based on the gradient of the optimized log-likelihood with respect to the fixed effects parameters. Using hessian-based convergence, probability of convergence was best for models that assumed the correct source of process error, assumed M was known, and did not assume SRRs.

Using marginal AIC provided most accurate inferences about the process errors on recruitment and survival and selectivity, in that AIC preferred EMs with assumed process errors that matched OMs, and EMs with those assumed process errors were not preferred when alternative process errors were assumed in the OMs. However, when the true process errors were more variable, AIC accuracy increased to a useful level. We found AIC more accurately determined a B-H SRR rather than the null model without a S-R relationship when there was low variability in recruitment, low variability in survival random effects, and higher variation in spawning biomass over the time series. When the median natural mortality rate was estimated, we found large bias and uncertainty much more likely in model output such as spawning stock biomass.

Bias in spawning stock biomass estimation was generally low for estimation models that assumed the correct source of process error when there was lower observation error. Reliable estimation of SRR parameters only appears possible in ideal situations with lower observation errors in age composition and indices, lower variability in recruitment process errors and large contrast in spawning biomass over time. We found little evidence of bias for many OM process error assumptions when there was contrast in fishing pressure even when there was greater observation error although it can lead to more variable estimates of natural mortality. For OMs where there was bias in natural mortality due to high observation error, estimation the SRR seemed to remove the bias. However, estimation of natural mortality can cause large differences between the true and estimated SSB (that may be unbiased on average) when there is less contrast in fishing pressure over time and higher observation error.

Retrospective patterns were generally weak for all estimation models regardless of the true source of process error, but they can be expected for recruitment even for the correct process error assumptions when observation error is high. When models did exhibit some retrospective pattern, estimation the median natural mortality rate tended to remove it.
-->

# Acknowledgements {-}

This work was funded by NOAA Fisheries Northeast Fisheries Science Center. 

<!--
# CRediT authorship contribution statement {-}

**Timothy J. Miller:** Conceptualization, Methodology, Writing - original draft, Formal analysis, Visualization.
 -->
 
\pagebreak

# References {-}

<div id="refs"></div>

\pagebreak


\clearpage

\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{type_4_convergence_plots}
\end{center}
\caption{Estimated probability of fits providing hessian-based standard errors for EMs assuming alternative process error (colored points and lines), and median natural mortality (estimated or known) and Beverton-Holt stock-recruit relationships (estimated or not; along x-axis) when fitted to operating models that have R and R+S (A), R+Sel (B), R+M (C), or R+q (D) process error structures. Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{hessian_SE_convergence}
\end{figure}
\end{landscape}

\clearpage

\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{pe_aic_plots}
\end{center}
\caption{Estimated probability of lowest AIC for EMs assuming alternative process error structures (colored bars) conditional on alternative assumptions for median natural mortality (estimated or known) and Beverton-Holt stock-recruit relationships (estimated or not; along x-axis) when fitted to operating models that have R and R+S (A), R+Sel (B), R+M (C), or R+q (D) process error structures. Striped bars indicate results where the EM process error structure matches that of the operating model.}\label{pe_aic}
\end{figure}
\end{landscape}

\clearpage

\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics[height = 0.8\textheight]{sr_aic_plots_rev}
\end{center}
\caption{Estimated probability of lowest AIC from logistic regression on the log-standard deviation of the true log(SSB) in each simulation for estimating model with Beverton-Holt stock-recruit relationships, rather than the otherwise equivalent EM without the stock-recruit relationship. Results are conditional on median M is known in the EM and alternative assumptions EMs having the correct process error structure: R and R+S (A), R+Sel (B), R+M (C), or R+q (D), and median M is assumed known in the EM. Solid and dashed lines are for OMs with and without temporal contrast in fishing pressure, respectively, and polygons represent 95\% confidence intervals. Range of results indicates the range of log-standard deviation of log(SSB) for simulations of the particular OM.}\label{sr_aic}
\end{figure}
\end{landscape}

\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{term_SSB_bias_plots}
\end{center}
\caption{Median relative error of terminal year SSB for estimating models fitted to data sets simulated with alternative process error structures: R and R+S (A), R+Sel (B), R+M (C), or R+q (D).  Diamond shaped points denote results where the EM process error assumption matches that of the operating model. Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{SSB_rel_error}
\end{figure}
\end{landscape}

\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{mohns_rho_ssb_plots}
\end{center}
\caption{Median Mohn's rho for SSB for estimating models fitted to data sets simulated with alternative process error structures: R and R+S (A), R+Sel (B), R+M (C), or R+q (D). Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{mohns_rho_ssb}
\end{figure}
\end{landscape}

\pagebreak

\setcounter{figure}{0}
\renewcommand\thefigure{S\arabic{figure}}

\setcounter{table}{0}
\renewcommand\thetable{S\arabic{table}}

# Supplementary Materials {-}

\begin{figure}[!ht]
\begin{center}
\includegraphics[width = \textwidth]{om_input_plots_figure}
\end{center}
\caption{The proportion mature at age, weight at age, fleet and index selectivity at age, and Beverton-Holt stock-recruit relationship assumed for the population in all operating models. For operating models with random effects on fleet selectivity, this represents the selectivity at the mean of the random effects.}\label{om_inputs_fig}
\end{figure}

\begin{landscape}
\begin{table}
\caption{Distinguishing characteristics of the operating models with random effects on recruitment and apparent survival (R.R+S). Standard deviations (SD) are for log-normal distributed indices and logistic normal distributed age composition observations (fleet and indices). Fishing mortality changes after year 20 (of 40) for fishing histories where fishing mortality is not constant.}\label{naa_om_table}
{\footnotesize \input{naa_om_tab}}
\end{table}
\end{landscape}

\begin{landscape}
\begin{table}
\caption{Distinguishing characteristics of the operating models with random effects on recruitment and natural mortality (R+M). Standard deviations (SD) are for log-normal distributed indices and logistic normal distributed age composition observations (fleet and indices). Fishing mortality changes after year 20 (of 40) for fishing histories where fishing mortality is not constant. For AR1 process errors, $\sigma$ is defined for the marginal distribution of the processes.}\label{M_om_table}
{\input{M_om_tab}}
\end{table}
\end{landscape}


\begin{landscape}
\begin{table}
\caption{Distinguishing characteristics of the operating models with random effects on recruitment and selectivity (R+Sel). Standard deviations (SD) are for log-normal distributed indices and logistic normal distributed age composition observations (fleet and indices). Fishing mortality changes after year 20 (of 40) for fishing histories where fishing mortality is not constant. For AR1 process errors, $\sigma$ is defined for the marginal distribution of the processes.}\label{sel_om_table}
{\input{Sel_om_tab}}
\end{table}
\end{landscape}


\begin{landscape}
\begin{table}
\caption{Distinguishing characteristics of the operating models with random effects on recruitment and catchability (R+q). Standard deviations (SD) are for log-normal distributed indices and logistic normal distributed age composition observations (fleet and indices). Fishing mortality changes after year 20 (of 40) for fishing histories where fishing mortality is not constant. For AR1 process errors, $\sigma$ is defined for the marginal distribution of the processes.}\label{q_om_table}
{\input{q_om_tab}}
\end{table}
\end{landscape}

\begin{table}
\caption{Distinguishing characteristics of the estimating models and operating model process error categories (R, R+S, R+M, R+Sel, R+q) where used.}\label{em_table}
{\scriptsize \input{em_tab}}
\end{table}



\clearpage

\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{hess_grad_convergence_plots}
\end{center}
\caption{The maximum of the absolute values of all gradient values for all fits that provided hessian-based standard errors across all simuated data sets of a given OM configuration (A: R and R+S, B: R+M, C: R+Sel, or D: R+q).  Results are conditional on EM fits with alternative process error type (colored points and lines), median natural mortality (estimated or known) and recruitment assumptions (Beverton-Holt stock-recruit relationship or not). Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{hess_grad}
\end{figure}
\end{landscape}


\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{type_3_convergence_plots}
\end{center}
\caption{Probability of estimating models providing maximum absolute values of gradients less than $10^{-6}$ assuming alternative process error (colored points and lines), and median natural mortality (estimated or known) and Beverton-Holt stock-recruit relationships (estimated or not; along x-axis) when fitted to operating models that have R and R+S (A), R+Sel (B), R+M (C), or R+q (D) process error structures. Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{gradient_convergence}
\end{figure}
\end{landscape}


\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{sr_aic_plots}
\end{center}
\caption{Estimated probability of lowest AIC from logistic regression on the log-standard deviation of the true log(SSB) in each simulation for estimating model with Beverton-Holt stock-recruit relationships, rather than the otherwise equivalent EM without the stock-recruit relationship. Results are conditional on alternative assumptions for median natural mortality (estimated or known) and on EMs having the correct process error structure: R and R+S (A), R+Sel (B), R+M (C), or R+q (D). Rug along x-axis denotes $SD(\log(SSB))$ values for each simulation and polygons represent 95\% confidence intervals.}\label{sr_aic_supp}
\end{figure}
\end{landscape}

\clearpage 

\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{term_F_bias_plots}
\end{center}
\caption{Median relative error of terminal year fully-selected fishing mortality for estimating models fitted to data sets simulated with alternative process error structures: R and R+S (A), R+Sel (B), R+M (C), or R+q (D). Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{F_rel_error}
\end{figure}
\end{landscape}

\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{term_R_bias_plots}
\end{center}
\caption{Median relative error of terminal year recruitment for estimating models fitted to data sets simulated with alternative process error structures: R and R+S (A), R+Sel (B), R+M (C), or R+q (D). Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{R_rel_error}
\end{figure}
\end{landscape}


\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{sr_bias_plots}
\end{center}
\caption{Median relative error of Beverton-Holt stock-recruit parameters ($a$ and $b$) for estimating models fitted to data sets simulated with alternative process error structures: R and R+S (A), R+Sel (B), R+M (C), or R+q (D). Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{SR_rel_error}
\end{figure}
\end{landscape}

\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{M_bias_plots}
\end{center}
\caption{Median relative error of median natural mortality for estimating models fitted to data sets simulated with alternative process error structures: R and R+S (A), R+Sel (B), R+M (C), or R+q (D). Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{M_rel_error}
\end{figure}
\end{landscape}


\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{mohns_rho_F_plots}
\end{center}
\caption{Median Mohn's $\rho$ of fishing mortality averaged over all age classes for estimating models fitted to data sets simulated with alternative process error structures: R and R+S (A), R+Sel (B), R+M (C), or R+q (D). Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{mohns_rho_F}
\end{figure}
\end{landscape}

\begin{landscape}
\begin{figure}
\begin{center}
\includegraphics{mohns_rho_R_plots}
\end{center}
\caption{Median Mohn's $\rho$ of recruitment for estimating models fitted to data sets simulated with alternative process error structures: R and R+S (A), R+Sel (B), R+M (C), or R+q (D). Circled values indicate results where the EM process error structure matches that of the operating model and vertical lines represent 95\% confidence intervals.}\label{mohns_rho_R}
\end{figure}
\end{landscape}
